<?xml version="1.0" encoding="utf-8"?><?workdir /C:\Git\XDocs-DITA-OT-185\XDocs-DITA-OT-185\DITA-OT1.8.5\temp\temp20190509171902990\Trident\device\devspec\ntb?><?workdir-uri file:/C:/Git/XDocs-DITA-OT-185/XDocs-DITA-OT-185/DITA-OT1.8.5/temp/temp20190509171902990/Trident/device/devspec/ntb/?><?path2project ..\?><?path2project-uri ../?><topic xmlns:ditaarch="http://dita.oasis-open.org/architecture/2005/" ditaarch:DITAArchVersion="1.2" class="- topic/topic " xml:lang="en-US" base="Saratoga" id="NTB_Doorbell_HW" domains="(topic hi-d)                             (topic ut-d)                             (topic indexing-d)                            (topic hazard-d)                            (topic abbrev-d)                            (topic pr-d)                             (topic sw-d)                            (topic ui-d)                            (topic struct-d)                            (topic firmware-d)                            (topic pmcrevhis-d)   " status="unchanged" xtrf="C:\Git\XDocs-DITA-OT-185\XDocs-DITA-OT-185\DITA-OT1.8.5\samples\diffed\_b-0-file-\Trident\device\devspec\ntb\trident_ntb_doorbells_messages.xml" xtrc="topic:1;11:27">
   <title class="- topic/title " xtrf="C:\Git\XDocs-DITA-OT-185\XDocs-DITA-OT-185\DITA-OT1.8.5\samples\diffed\_b-0-file-\Trident\device\devspec\ntb\trident_ntb_doorbells_messages.xml" xtrc="title:1;14:26">Doorbells and Message Registers</title>
   <body class="- topic/body " xtrf="C:\Git\XDocs-DITA-OT-185\XDocs-DITA-OT-185\DITA-OT1.8.5\samples\diffed\_b-0-file-\Trident\device\devspec\ntb\trident_ntb_doorbells_messages.xml" xtrc="body:1;17:24">
      <note audience="PMCInternal" class="- topic/note " xtrf="C:\Git\XDocs-DITA-OT-185\XDocs-DITA-OT-185\DITA-OT1.8.5\samples\diffed\_b-0-file-\Trident\device\devspec\ntb\trident_ntb_doorbells_messages.xml" xtrc="note:1;21:27">
         <simpletable relcolwidth="154* 846*" class="- topic/simpletable " xtrf="C:\Git\XDocs-DITA-OT-185\XDocs-DITA-OT-185\DITA-OT1.8.5\samples\diffed\_b-0-file-\Trident\device\devspec\ntb\trident_ntb_doorbells_messages.xml" xtrc="simpletable:1;25:44">
            <strow class="- topic/strow " xtrf="C:\Git\XDocs-DITA-OT-185\XDocs-DITA-OT-185\DITA-OT1.8.5\samples\diffed\_b-0-file-\Trident\device\devspec\ntb\trident_ntb_doorbells_messages.xml" xtrc="strow:1;28:35">
               <stentry class="- topic/stentry " xtrf="C:\Git\XDocs-DITA-OT-185\XDocs-DITA-OT-185\DITA-OT1.8.5\samples\diffed\_b-0-file-\Trident\device\devspec\ntb\trident_ntb_doorbells_messages.xml" xtrc="stentry:1;31:42">Owner</stentry>
               <stentry class="- topic/stentry " xtrf="C:\Git\XDocs-DITA-OT-185\XDocs-DITA-OT-185\DITA-OT1.8.5\samples\diffed\_b-0-file-\Trident\device\devspec\ntb\trident_ntb_doorbells_messages.xml" xtrc="stentry:2;34:42">FW</stentry>
            </strow>
            <strow class="- topic/strow " xtrf="C:\Git\XDocs-DITA-OT-185\XDocs-DITA-OT-185\DITA-OT1.8.5\samples\diffed\_b-0-file-\Trident\device\devspec\ntb\trident_ntb_doorbells_messages.xml" xtrc="strow:2;38:35">
               <stentry class="- topic/stentry " xtrf="C:\Git\XDocs-DITA-OT-185\XDocs-DITA-OT-185\DITA-OT1.8.5\samples\diffed\_b-0-file-\Trident\device\devspec\ntb\trident_ntb_doorbells_messages.xml" xtrc="stentry:3;41:42">References</stentry>
               <stentry class="- topic/stentry " xtrf="C:\Git\XDocs-DITA-OT-185\XDocs-DITA-OT-185\DITA-OT1.8.5\samples\diffed\_b-0-file-\Trident\device\devspec\ntb\trident_ntb_doorbells_messages.xml" xtrc="stentry:4;44:43"/>
            </strow>
            <strow class="- topic/strow " xtrf="C:\Git\XDocs-DITA-OT-185\XDocs-DITA-OT-185\DITA-OT1.8.5\samples\diffed\_b-0-file-\Trident\device\devspec\ntb\trident_ntb_doorbells_messages.xml" xtrc="strow:3;48:35">
               <stentry class="- topic/stentry " xtrf="C:\Git\XDocs-DITA-OT-185\XDocs-DITA-OT-185\DITA-OT1.8.5\samples\diffed\_b-0-file-\Trident\device\devspec\ntb\trident_ntb_doorbells_messages.xml" xtrc="stentry:5;51:42">Goal</stentry>
               <stentry class="- topic/stentry " xtrf="C:\Git\XDocs-DITA-OT-185\XDocs-DITA-OT-185\DITA-OT1.8.5\samples\diffed\_b-0-file-\Trident\device\devspec\ntb\trident_ntb_doorbells_messages.xml" xtrc="stentry:6;54:42">To describe the architecture and usage of doorbells and message registers as well as how to access them over GAS</stentry>
            </strow>
         </simpletable>
      </note>
      <p class="- topic/p " xtrf="C:\Git\XDocs-DITA-OT-185\XDocs-DITA-OT-185\DITA-OT1.8.5\samples\diffed\_b-0-file-\Trident\device\devspec\ntb\trident_ntb_doorbells_messages.xml" xtrc="p:1;60:21">The Switchtec Logical NT Architecture allows multiple hosts and the EPs to communicate across partitions. Fundamentally, an NT Endpoint is made up of:</p>
      <ul class="- topic/ul " xtrf="C:\Git\XDocs-DITA-OT-185\XDocs-DITA-OT-185\DITA-OT1.8.5\samples\diffed\_b-0-file-\Trident\device\devspec\ntb\trident_ntb_doorbells_messages.xml" xtrc="ul:1;63:23">
         <li class="- topic/li " xtrf="C:\Git\XDocs-DITA-OT-185\XDocs-DITA-OT-185\DITA-OT1.8.5\samples\diffed\_b-0-file-\Trident\device\devspec\ntb\trident_ntb_doorbells_messages.xml" xtrc="li:1;66:26">
            <p class="- topic/p " xtrf="C:\Git\XDocs-DITA-OT-185\XDocs-DITA-OT-185\DITA-OT1.8.5\samples\diffed\_b-0-file-\Trident\device\devspec\ntb\trident_ntb_doorbells_messages.xml" xtrc="p:2;69:27"> Address Translation Windows and Sub-Windows</p>
         </li>
         <li class="- topic/li " xtrf="C:\Git\XDocs-DITA-OT-185\XDocs-DITA-OT-185\DITA-OT1.8.5\samples\diffed\_b-0-file-\Trident\device\devspec\ntb\trident_ntb_doorbells_messages.xml" xtrc="li:2;73:26">
            <p class="- topic/p " xtrf="C:\Git\XDocs-DITA-OT-185\XDocs-DITA-OT-185\DITA-OT1.8.5\samples\diffed\_b-0-file-\Trident\device\devspec\ntb\trident_ntb_doorbells_messages.xml" xtrc="p:3;76:27"> Doorbells</p>
         </li>
         <li class="- topic/li " xtrf="C:\Git\XDocs-DITA-OT-185\XDocs-DITA-OT-185\DITA-OT1.8.5\samples\diffed\_b-0-file-\Trident\device\devspec\ntb\trident_ntb_doorbells_messages.xml" xtrc="li:3;80:26">
            <p class="- topic/p " xtrf="C:\Git\XDocs-DITA-OT-185\XDocs-DITA-OT-185\DITA-OT1.8.5\samples\diffed\_b-0-file-\Trident\device\devspec\ntb\trident_ntb_doorbells_messages.xml" xtrc="p:4;83:27"> Message Registers</p>
         </li>
      </ul>
      <p class="- topic/p " xtrf="C:\Git\XDocs-DITA-OT-185\XDocs-DITA-OT-185\DITA-OT1.8.5\samples\diffed\_b-0-file-\Trident\device\devspec\ntb\trident_ntb_doorbells_messages.xml" xtrc="p:5;88:21">This section describes HW implementations of the Doorbell and the Message Registers.</p>
      <section id="section_Doorbell_Registers_0i6dwc37w" class="- topic/section " xtrf="C:\Git\XDocs-DITA-OT-185\XDocs-DITA-OT-185\DITA-OT1.8.5\samples\diffed\_b-0-file-\Trident\device\devspec\ntb\trident_ntb_doorbells_messages.xml" xtrc="section:1;92:33">
         <title class="- topic/title " xtrf="C:\Git\XDocs-DITA-OT-185\XDocs-DITA-OT-185\DITA-OT1.8.5\samples\diffed\_b-0-file-\Trident\device\devspec\ntb\trident_ntb_doorbells_messages.xml" xtrc="title:2;95:32">Doorbells</title>
         <p class="- topic/p " xtrf="C:\Git\XDocs-DITA-OT-185\XDocs-DITA-OT-185\DITA-OT1.8.5\samples\diffed\_b-0-file-\Trident\device\devspec\ntb\trident_ntb_doorbells_messages.xml" xtrc="p:6;98:24">Doorbells facilitate communications between different NT functions. Each NT function has the ability to send doorbells to any other NT function, across switch partitions. Doorbells are the mechanism to convert memory write to an interrupt towards hosts in different NT partitions. Each NT function in Switchtec implements a 64-bit outbound doorbell register and a 64-bit inbound doorbell register. Each bit associated with a doorbell register can be mapped to interrupt any number of hosts. As an example, a host may ring a single doorbell to interrupt multiple hosts using their unique MSI-X. <xref href="#NTB_Doorbell_HW/fig_NTB_Inbound_and_Outbound_Registers_1i6dwc37w" class="- topic/xref " xtrf="C:\Git\XDocs-DITA-OT-185\XDocs-DITA-OT-185\DITA-OT1.8.5\samples\diffed\_b-0-file-\Trident\device\devspec\ntb\trident_ntb_doorbells_messages.xml" xtrc="xref:1;101:33" type="fig"><?ditaot gentext?>Figure 1</xref> below illustrates doorbell masking and routing. Outbound and inbound doorbell registers are labeled as NTB ODB and NTB IDB, respectively. A host can write all 64 bits which go through the outbound mask register. If the doorbell mask is enabled, then appropriate MSI-X Vector writes are routed to an appropriate inbound register as illustrated in the figure below. A similar mechanism may also be applied to implement more complex communication between the hosts.</p>
         <note audience="MSCCInternal" class="- topic/note " xtrf="C:\Git\XDocs-DITA-OT-185\XDocs-DITA-OT-185\DITA-OT1.8.5\samples\diffed\_b-0-file-\Trident\device\devspec\ntb\trident_ntb_doorbells_messages.xml" xtrc="note:2;105:30">
            <p class="- topic/p " xtrf="C:\Git\XDocs-DITA-OT-185\XDocs-DITA-OT-185\DITA-OT1.8.5\samples\diffed\_b-0-file-\Trident\device\devspec\ntb\trident_ntb_doorbells_messages.xml" xtrc="p:7;108:27">Source Graphics: <xref href="http://bby1dms01.pmc-sierra.internal/DocMgmt/fileinfo.cfm?file_id=440057" scope="external" class="- topic/xref " xtrf="C:\Git\XDocs-DITA-OT-185\XDocs-DITA-OT-185\DITA-OT1.8.5\samples\diffed\_b-0-file-\Trident\device\devspec\ntb\trident_ntb_doorbells_messages.xml" xtrc="xref:2;112:36"><?ditaot usertext?>http://bby1dms01.pmc-sierra.internal/DocMgmt/fileinfo.cfm?file_id=440057 </xref>
            </p>
         </note>
         <fig id="fig_NTB_Inbound_and_Outbound_Registers_1i6dwc37w" class="- topic/fig " xtrf="C:\Git\XDocs-DITA-OT-185\XDocs-DITA-OT-185\DITA-OT1.8.5\samples\diffed\_b-0-file-\Trident\device\devspec\ntb\trident_ntb_doorbells_messages.xml" xtrc="fig:1;118:28">
            <title class="- topic/title " xtrf="C:\Git\XDocs-DITA-OT-185\XDocs-DITA-OT-185\DITA-OT1.8.5\samples\diffed\_b-0-file-\Trident\device\devspec\ntb\trident_ntb_doorbells_messages.xml" xtrc="title:3;121:35">NTB Inbound and Outbound Registers</title>
            <image href="../../../../Saratoga/Device/ddd_hws/04_Functional_Description/Graphics_2/doorbell_regs.svg" placement="inline" width="496" class="- topic/image " xtrf="C:\Git\XDocs-DITA-OT-185\XDocs-DITA-OT-185\DITA-OT1.8.5\samples\diffed\_b-0-file-\Trident\device\devspec\ntb\trident_ntb_doorbells_messages.xml" xtrc="image:1;127:36"/>
         </fig>
      </section>
      <section id="section_Message_Registers_2i6dwc37w" class="- topic/section " xtrf="C:\Git\XDocs-DITA-OT-185\XDocs-DITA-OT-185\DITA-OT1.8.5\samples\diffed\_b-0-file-\Trident\device\devspec\ntb\trident_ntb_doorbells_messages.xml" xtrc="section:2;133:33">
         <title class="- topic/title " xtrf="C:\Git\XDocs-DITA-OT-185\XDocs-DITA-OT-185\DITA-OT1.8.5\samples\diffed\_b-0-file-\Trident\device\devspec\ntb\trident_ntb_doorbells_messages.xml" xtrc="title:4;136:32">Message Registers</title>
         <p class="- topic/p " xtrf="C:\Git\XDocs-DITA-OT-185\XDocs-DITA-OT-185\DITA-OT1.8.5\samples\diffed\_b-0-file-\Trident\device\devspec\ntb\trident_ntb_doorbells_messages.xml" xtrc="p:8;139:24">NTB Messaging is another mechanism that allows 32-bit messages to be communicated between partitions. Messages are typically used for passing pointers between hosts for inter-Processor communications. In addition, Switchtec Message registers can also generate interrupts using the MSI-X interrupt mechanism. Each NT function has a single memory mapped register that maps each of 4 outbound 32-bit messages into a single inbound message in a single destination partition. </p>
         <p class="- topic/p " xtrf="C:\Git\XDocs-DITA-OT-185\XDocs-DITA-OT-185\DITA-OT1.8.5\samples\diffed\_b-0-file-\Trident\device\devspec\ntb\trident_ntb_doorbells_messages.xml" xtrc="p:9;142:24">Similar to the doorbell mechanism, a write to one of the four outbound message registers results in an interrupt being sent to the single inbound message register in the partition. Each inbound message register can be mapped to one (or up to four) outbound message registers. However, a single outbound message register can only mapped to a single inbound message register.</p>
      </section>
      <section id="section_Doorbell_Message_Register_Architecture_3i6dwc37w" class="- topic/section " xtrf="C:\Git\XDocs-DITA-OT-185\XDocs-DITA-OT-185\DITA-OT1.8.5\samples\diffed\_b-0-file-\Trident\device\devspec\ntb\trident_ntb_doorbells_messages.xml" xtrc="section:3;147:33">
         <title class="- topic/title " xtrf="C:\Git\XDocs-DITA-OT-185\XDocs-DITA-OT-185\DITA-OT1.8.5\samples\diffed\_b-0-file-\Trident\device\devspec\ntb\trident_ntb_doorbells_messages.xml" xtrc="title:5;150:32">Doorbell / Message Register Architecture</title>
         <p class="- topic/p " xtrf="C:\Git\XDocs-DITA-OT-185\XDocs-DITA-OT-185\DITA-OT1.8.5\samples\diffed\_b-0-file-\Trident\device\devspec\ntb\trident_ntb_doorbells_messages.xml" xtrc="p:10;153:25">Typically inter-host interrupt is a control plane function that is handled in firmware. However, implementing the doorbell functionality in firmware could also result in undesired latency and therefore this function is implemented in HW.</p>
      </section>
      <p class="- topic/p " xtrf="C:\Git\XDocs-DITA-OT-185\XDocs-DITA-OT-185\DITA-OT1.8.5\samples\diffed\_b-0-file-\Trident\device\devspec\ntb\trident_ntb_doorbells_messages.xml" xtrc="p:11;157:22">All of the transactions associated with NT doorbell and message registers including MSI-X specific operation specifics are handled within the PPU block as shown in <xref href="#NTB_Doorbell_HW/fig_NTB_Inbound_and_Outbound_Registers_1i6dwc37w" class="- topic/xref " xtrf="C:\Git\XDocs-DITA-OT-185\XDocs-DITA-OT-185\DITA-OT1.8.5\samples\diffed\_b-0-file-\Trident\device\devspec\ntb\trident_ntb_doorbells_messages.xml" xtrc="xref:3;160:30" type="fig"><?ditaot gentext?>Figure 1</xref>. As an example, if one port performs a doorbell write, it will get routed through the PPU. The PPU will process it and if there are one or more interrupts (MSI-X vector writes), it will perform those. The PPU behaves like a dedicated stack that has bifurcated 8 x2 port interface. One of the channels of this interface is dedicated for special doorbell and NTB processing. If multiple partitions are attempting to write to multiple partitions, it could result in congestion. This can be mitigated by using TLP throttling to prevent one channel from affecting transactions on other channel.</p>
   </body>
</topic>